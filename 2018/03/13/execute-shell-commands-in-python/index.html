<!DOCTYPE html>
<html lang="en">
<head>

  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">
  
  
  
  
    
  
      <title>Execute Shell Commands in Python - Infinite.ft的博客</title>
  
  
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FONT
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">

  <!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->

  <link rel="stylesheet" href="/css/normalize.css">
<link rel="stylesheet" href="/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/gridlex.min.css">
<link rel="stylesheet" href="/css/skeleton.css">
<link rel="stylesheet" href="/css/theme.css">
<link rel="stylesheet" href="/css/share.min.css">
<link rel="stylesheet" href="/css/lightgallery.css">

  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {inlineMath: [["$","$"],['\\(','\\)']]}
  });
  </script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
    <script src="/js/social-share.min.js"></script>
    <script src="/js/theme.js"></script>

  <!-- include cookie.js -->
  
  

  <!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="icon" type="image/png" href="/images/favicon.png">

<link rel="stylesheet" href="/css/prism-atom-dark.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body style="display: flex; flex-direction: column; min-height: 100vh;">
  <header class="header">
	<div class="header-title">
		
			<div class='header-logo'><a href='/'>
				<img class='grow' src='/images/avatar.png' />
			</a></div>
			<div class='header-text' >
			    <h1>Infinite.ft的博客</h1>
				<p><small></small></p>
			</div>
		
	</div>
	<div id="header-menu-container">
		<nav class="menu">
	
		
	
	<div class='menu-item grow'>
		<div class='menu-icon'>
			<a href="/archives/">
			<img src="/images/archive.svg" alt="">
			</a>
		</div>
		<div class="menu-name">
			<a class='menu-link' href="/archives/">
				<span>Archives</span>
			</a>
		</div>
	</div>
	
	
		
		
			<div class='menu-item grow'>
			
				<div class='menu-icon'>
				<a href="/">
					<img src="/images/home.svg" alt="">
					</a>
					</div>
					
					<div class="menu-name">
						<a class='menu-link' href="/">
							<span>Home</span>
						</a>
					</div>
				</a>
			</div>
		
	
	<div class='menu-item grow'>
		<div class='menu-icon'>
			<a href="/search/">
			<img src="/images/search.svg" alt="">
			</a>
		</div>
		<div class="menu-name">
			<a class='menu-link' href="/search/">
				<span>Search</span>
			</a>
		</div>
	</div>
</nav>

	</div>
</header>

  <!-- Primary Page Layout
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <div style="flex: 1;">
      <style>
    body {
        background-color: white;
    }
</style>

<article class="article" id="/2018/03/13/execute-shell-commands-in-python/" data-name='Execute Shell Commands in Python' data-version="">

    <!-- Title -->

    
        
            
                
                
            
        
    

    <div class='article-header'>
         
         <h1 class='article-title'>
            <a href="/2018/03/13/execute-shell-commands-in-python/">
                Execute Shell Commands in Python
            </a>
        </h1>
        
        <ul class='article-categories'>
            
            
                <li><a href="/categories/tech/" data-no-instant>
                    <img src="/images/tech.svg" alt="tech" />
                </a></li>
            
        </ul>
        
    </div>
   
    <!-- Date and Author -->
    <p>
       	2018-03-13
        by infinite.ft
        
    </p>
    <p>
        

	
		<label><a href="/tags/python/">#Python</a></label>
	

	
		<label><a href="/tags/shell/">#Shell</a></label>
	


    </p>
	<hr />

    <!-- Gallery -->
    
    

    <!-- Content -->
    <div class='article-content'>
    <p>Executing shell commands in python is always attractive to me. On the one hand, shell script normally meets my daily demands, I think there has no very strong reasons to learn it. On the other hand, my focus in Python is not here, there are few chances to get in touch with it. But now, the powerful ability of Python executing shell commands impress me, as I dive into the deeper place in Python’s world. For that reason, I think it’s time to get hands on it. Here I will summarize the approaches  executing shell commands in Python.</p>
<h4 id="1-subprocess-call"><a href="#1-subprocess-call" class="headerlink" title="1. subprocess.call"></a>1. <code>subprocess.call</code></h4><p>This approach is very known to  the most of developers. <a href="https://docs.python.org/3/library/subprocess.html" target="_blank" rel="external">subprocess</a> module is built in python library. It allows you to spawn new processes, connected to their input/output/error pipes, and obtain their return codes. It intends to replace several older modules and functions:</p>
<pre class="line-numbers language-lang-shell"><code class="language-lang-shell">os.system
os.spwan
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>The related PEP is <a href="https://www.python.org/dev/peps/pep-0324" target="_blank" rel="external">PEP 324</a> which proposed the subprocess module.</p>
<p>In <em>subprocess</em>, the <code>run()</code> function is the most powerful and convenient  function , it can handle all use cases. Unfortunately, the <code>run()</code> was added in Python 3.5,  so if you want to keep compatibility with older version, your might need to use older high-level API <a href="https://docs.python.org/3/library/subprocess.html#call-function-trio" target="_blank" rel="external">call()</a>. The prototype of <code>run()</code> is followed:</p>
<p><code>subprocess.run</code>(<em>args</em>, * , <em>stdin=None</em>, <em>input=None</em>, <em>stdout=None</em>, <em>stderr=None</em>, <em>shell=False</em>, <em>cwd=None</em>, <em>timeout=None</em>, <em>check=False</em>, <em>encoding=None</em>, <em>errors=None</em>)<a href="https://docs.python.org/3/library/subprocess.html#subprocess.run" target="_blank" rel="external">¶</a></p>
<p>The underlying mechanism of <code>run()</code> is just a proxy for <a href="https://docs.python.org/3/library/subprocess.html#subprocess.Popen" target="_blank" rel="external">Popen</a> which provide a lot of flexibility so that developers are able to handle the less common cases not covered by the convenience functions.</p>
<p><strong>args</strong> : command list included the command name and parameters.</p>
<p><strong>stdin</strong>: pass to <a href="https://docs.python.org/3/library/subprocess.html#subprocess.Popen" target="_blank" rel="external">Popen</a></p>
<p><strong>input</strong>: pass to <a href="https://docs.python.org/3/library/subprocess.html#subprocess.Popen" target="_blank" rel="external">Popen</a></p>
<p><strong>stdout</strong>: pass to <a href="https://docs.python.org/3/library/subprocess.html#subprocess.Popen" target="_blank" rel="external">Popen</a></p>
<p><strong>stderr</strong>: pass to <a href="https://docs.python.org/3/library/subprocess.html#subprocess.Popen" target="_blank" rel="external">Popen</a></p>
<p><strong>shell</strong>: pass to <a href="https://docs.python.org/3/library/subprocess.html#subprocess.Popen" target="_blank" rel="external">Popen</a></p>
<p><strong>cwd</strong>: pass to <a href="https://docs.python.org/3/library/subprocess.html#subprocess.Popen" target="_blank" rel="external">Popen</a></p>
<p><strong>timeout</strong>: pass to <code>Popen.communicate()</code>. If the timeout expires, the child process will be killed. The<code>TimeoutExpired</code> exception will be raised after the child process has terminated. </p>
<p><strong>check</strong>: Check whether the process exits with a non-zero exit code. if that , a <code>CalledProcessError</code> exception will be raised.  Attribute of that exception contain the arguments, the exit code, and stdout and stderr if they were captured.</p>
<p><strong>encoding/errors</strong>: if either <em>encoding</em> or <em>error</em> are specified, file objects for stdin, stdout and stderr are opened in text mode using specified encoding and errors or the <code>io.TextIOWrapper</code> default. Otherwise, file objects are opened in binary mode.</p>
<p>The <code>run()</code> function runs the command described by args. Then wait for command to complete, finally return a <code>CompletedProcess</code> instance which hold <em>args</em>, <em>returncode</em>, <em>stdout</em>, <em>stderr</em> and check_returncode(). . By default, <code>run()</code> does not capture stdout or stderr. To do so pass <code>PIPE</code> for the stdou and/or stderr arguments</p>
<p>Examples:</p>
<pre class="line-numbers language-lang-python"><code class="language-lang-python">>>> import subprocess
>>> subprocess.run(["echo","-e", "\e[0;32m hello world \e[;m"])
hello world
CompletedProcess(args=['echo', '-e', '\\e[0;32m hello world\\e[;m'], returncode=0)
>>> cp = subprocess.run(["ls", "-al"], stdout=subprocess.PIPE) # capture stdout
>>> cp.stdout # access to the stdout
>>> cp.stderr # access to the stderr
>>> cp.returncode # get return code
>>> cp.check_returncode() # when returncode is a non-zero value, a CalledProcessError will be raised
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="2-Other-approaches"><a href="#2-Other-approaches" class="headerlink" title="2. Other approaches"></a>2. Other approaches</h4><ul>
<li><code>os.popen</code></li>
</ul>
<pre class="line-numbers language-lang-python"><code class="language-lang-python">>>> import os
>>>> ret = os.popen('ls -al').read() # or os.popen('ls -al').readline()
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li><code>commands</code></li>
</ul>
<p><code>commands.getstatusoutput(cmd)</code>: return (status, output)</p>
<p><code>commands.getoutput(cmd)</code>: return (output)</p>
<p><code>commands.getstatus(file)</code>: get the status of the specific file</p>
<pre class="line-numbers language-lang-python"><code class="language-lang-python">>>> import commands
>>> status,output = commands.getstatusoutput("ls")
>>> output = commands.getoutput("ls -al")
>>> status = commands.getstatus("hello.c")
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>Note</strong>: The  <code>commands</code> module only exists in Python2.x , since this  module has been removed in Python3.x.</p>
<p>This method is much similar to <code>popen</code>, the difference is that <code>popen</code> returns file-like object</p>
<ul>
<li><code>os.system</code></li>
</ul>
<p>This method is not recommend to use. In Python &gt;= 3.5, it’s recommend to <code>subprocess</code>.</p>
<pre class="line-numbers language-lang-python"><code class="language-lang-python">>>> import os
>>> os.system("ls")
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>The downside of this method is that you must handle security stuffs yourself, like shell character escaping, etc. On top of that, this method cannot run the external programs.</p>

    </div>
    <hr />

    <h2>Share and comment</h2>
    <div class="social-share"></div>
    
        <div id="disqus_thread"></div>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    

    
    
</article>
  </div>

  <footer class='footer'>
    <div class='footer-logo'>
        <span>infinite.ft</span>
    </div>
    <div class='footer-social'>
        
        
            
                
                    <div class='footer-social-item'><a href='https://www.facebook.com/huang.biao.77' target='_blank' title='Find me on facebook' ><i class="fa fa-facebook fa-2x" aria-hidden="true"></i></a></div>
                
            
                
                    <div class='footer-social-item'><a href='https://twitter.com/19941222hb' target='_blank' title='Find me on twitter' ><i class="fa fa-twitter fa-2x" aria-hidden="true"></i></a></div>
                
            
                
                    <div class='footer-social-item'><a href='mailto:infinite.ft@gmail.com' target='_blank' title='Find me on mail' ><i class="fa fa-mail fa-2x" aria-hidden="true"></i></a></div>
                
            
        
    </div>
    <p> Copyright by <a href="">@infinite.ft</a> in 2018</p>
    <p> Icons by <a href="http://www.freepik.com" title="Freepik">Freepik</a> from <a href="http://www.flaticon.com" title="Flaticon">Flaticon</a> is licensed by <a href="http://creativecommons.org/licenses/by/3.0/" title="Creative Commons BY 3.0" target="_blank">CC 3.0</a></p>
    <p>Theme <a href="http://qutang.github.io/2017/06/27/Hexo-theme-cutie/">Cutie 1.0.0</a> | Powered by <a href="http://hexo.io">Hexo.</a></p>
</footer>

  <br>

  <div id="footer-menu-container">
		<nav class="menu">
	
		
	
	<div class='menu-item grow'>
		<div class='menu-icon'>
			<a href="/archives/">
			<img src="/images/archive.svg" alt="">
			</a>
		</div>
		<div class="menu-name">
			<a class='menu-link' href="/archives/">
				<span>Archives</span>
			</a>
		</div>
	</div>
	
	
		
		
			<div class='menu-item grow'>
			
				<div class='menu-icon'>
				<a href="/">
					<img src="/images/home.svg" alt="">
					</a>
					</div>
					
					<div class="menu-name">
						<a class='menu-link' href="/">
							<span>Home</span>
						</a>
					</div>
				</a>
			</div>
		
	
	<div class='menu-item grow'>
		<div class='menu-icon'>
			<a href="/search/">
			<img src="/images/search.svg" alt="">
			</a>
		</div>
		<div class="menu-name">
			<a class='menu-link' href="/search/">
				<span>Search</span>
			</a>
		</div>
	</div>
</nav>

	</div>

  <script>
/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://qutang-github-io.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>

<script src="/js/lightgallery.min.js"></script>
<script type='text/javascript'>
    lightGallery(document.getElementById('lightgallery'));
</script>

<script data-no-instant type='text/javascript'>
changeLayoutOnTouchScreen();
setVersionForCurrentPage();
setVersionBadgeForIndexPages();
</script>

<!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
</body>
</html>
