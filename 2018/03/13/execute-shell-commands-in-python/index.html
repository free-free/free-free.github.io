<!DOCTYPE html><html lang="en,zh-cn,default"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Execute Shell Commands in Python · Infinite.ft的博客</title><meta name="description" content="Execute Shell Commands in Python - infinite.ft"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://free-free.github.io/atom.xml" title="Infinite.ft的博客"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">HOME</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/categories/math" target="_self" class="nav-list-link">MATH</a></li><li class="nav-list-item"><a href="/categories/tech" target="_self" class="nav-list-link">TECH</a></li><li class="nav-list-item"><a href="/categories/mylife" target="_self" class="nav-list-link">NOTES</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Execute Shell Commands in Python</h1><div class="post-info">Mar 13, 2018</div><div class="post-content"><p>Executing shell commands in python is not always attractive to me. On the one hand, shell script normally meets my daily demands, I think there are no very strong reasons to learn it. On the other hand, my focus in Python is not here, there are few chances to get in touch with it. But now, the powerful ability of Python executing shell commands impress me, as I dive into the deeper place in Python’s world. For that reason, I think it’s time to get hands on it. Here I will summarize the approaches  executing shell commands in Python.</p>
<h4 id="1-subprocess-call"><a href="#1-subprocess-call" class="headerlink" title="1. subprocess.call"></a>1. <code>subprocess.call</code></h4><p>This approach is very known to  the most of developers. <a href="https://docs.python.org/3/library/subprocess.html" target="_blank" rel="external">subprocess</a> module is built in python library. It allows you to spawn new processes, connected to their input/output/error pipes, and obtain their return codes. It intends to replace several older modules and functions:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">os.system</div><div class="line">os.spwan</div></pre></td></tr></table></figure>
<p>The related PEP is <a href="https://www.python.org/dev/peps/pep-0324" target="_blank" rel="external">PEP 324</a> which proposed the subprocess module.</p>
<p>In <em>subprocess</em>, the <code>run()</code> function is the most powerful and convenient  function , it can handle all use cases. Unfortunately, the <code>run()</code> was added in Python 3.5,  so if you want to keep compatibility with older version, your might need to use older high-level API <a href="https://docs.python.org/3/library/subprocess.html#call-function-trio" target="_blank" rel="external">call()</a>. The prototype of <code>run()</code> is followed:</p>
<p><code>subprocess.run</code>(<em>args</em>, * , <em>stdin=None</em>, <em>input=None</em>, <em>stdout=None</em>, <em>stderr=None</em>, <em>shell=False</em>, <em>cwd=None</em>, <em>timeout=None</em>, <em>check=False</em>, <em>encoding=None</em>, <em>errors=None</em>)<a href="https://docs.python.org/3/library/subprocess.html#subprocess.run" target="_blank" rel="external">¶</a></p>
<p>The underlying mechanism of <code>run()</code> is just a proxy for <a href="https://docs.python.org/3/library/subprocess.html#subprocess.Popen" target="_blank" rel="external">Popen</a> which provide a lot of flexibility so that developers are able to handle the less common cases not covered by the convenience functions.</p>
<p><strong>args</strong> : command list included the command name and parameters.</p>
<p><strong>stdin</strong>: pass to <a href="https://docs.python.org/3/library/subprocess.html#subprocess.Popen" target="_blank" rel="external">Popen</a></p>
<p><strong>input</strong>: pass to <a href="https://docs.python.org/3/library/subprocess.html#subprocess.Popen" target="_blank" rel="external">Popen</a></p>
<p><strong>stdout</strong>: pass to <a href="https://docs.python.org/3/library/subprocess.html#subprocess.Popen" target="_blank" rel="external">Popen</a></p>
<p><strong>stderr</strong>: pass to <a href="https://docs.python.org/3/library/subprocess.html#subprocess.Popen" target="_blank" rel="external">Popen</a></p>
<p><strong>shell</strong>: pass to <a href="https://docs.python.org/3/library/subprocess.html#subprocess.Popen" target="_blank" rel="external">Popen</a></p>
<p><strong>cwd</strong>: pass to <a href="https://docs.python.org/3/library/subprocess.html#subprocess.Popen" target="_blank" rel="external">Popen</a></p>
<p><strong>timeout</strong>: pass to <code>Popen.communicate()</code>. If the timeout expires, the child process will be killed. The<code>TimeoutExpired</code> exception will be raised after the child process has terminated. </p>
<p><strong>check</strong>: Check whether the process exits with a non-zero exit code. if that , a <code>CalledProcessError</code> exception will be raised.  Attribute of that exception contain the arguments, the exit code, and stdout and stderr if they were captured.</p>
<p><strong>encoding/errors</strong>: if either <em>encoding</em> or <em>error</em> are specified, file objects for stdin, stdout and stderr are opened in text mode using specified encoding and errors or the <code>io.TextIOWrapper</code> default. Otherwise, file objects are opened in binary mode.</p>
<p>The <code>run()</code> function runs the command described by args. Then wait for command to complete, finally return a <code>CompletedProcess</code> instance which hold <em>args</em>, <em>returncode</em>, <em>stdout</em>, <em>stderr</em> and check_returncode(). . By default, <code>run()</code> does not capture stdout or stderr. To do so pass <code>PIPE</code> for the stdou and/or stderr arguments</p>
<p>Examples:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> subprocess</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>subprocess.run([<span class="string">"echo"</span>,<span class="string">"-e"</span>, <span class="string">"\e[0;32m hello world \e[;m"</span>])</div><div class="line">hello world</div><div class="line">CompletedProcess(args=[<span class="string">'echo'</span>, <span class="string">'-e'</span>, <span class="string">'\\e[0;32m hello world\\e[;m'</span>], returncode=<span class="number">0</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>cp = subprocess.run([<span class="string">"ls"</span>, <span class="string">"-al"</span>], stdout=subprocess.PIPE) <span class="comment"># capture stdout</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>cp.stdout <span class="comment"># access to the stdout</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>cp.stderr <span class="comment"># access to the stderr</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>cp.returncode <span class="comment"># get return code</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>cp.check_returncode() <span class="comment"># when returncode is a non-zero value, a CalledProcessError will be raised</span></div></pre></td></tr></table></figure>
<h4 id="2-Other-approaches"><a href="#2-Other-approaches" class="headerlink" title="2. Other approaches"></a>2. Other approaches</h4><ul>
<li><code>os.popen</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> os</div><div class="line">&gt;&gt;&gt;&gt; ret = os.popen(<span class="string">'ls -al'</span>).read() <span class="comment"># or os.popen('ls -al').readline()</span></div></pre></td></tr></table></figure>
<ul>
<li><code>commands</code></li>
</ul>
<p><code>commands.getstatusoutput(cmd)</code>: return (status, output)</p>
<p><code>commands.getoutput(cmd)</code>: return (output)</p>
<p><code>commands.getstatus(file)</code>: get the status of the specific file</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> commands</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>status,output = commands.getstatusoutput(<span class="string">"ls"</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>output = commands.getoutput(<span class="string">"ls -al"</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>status = commands.getstatus(<span class="string">"hello.c"</span>)</div></pre></td></tr></table></figure>
<p><strong>Note</strong>: The  <code>commands</code> module only exists in Python2.x , since this  module has been removed in Python3.x.</p>
<p>This method is much similar to <code>popen</code>, the difference is that <code>popen</code> returns file-like object</p>
<ul>
<li><code>os.system</code></li>
</ul>
<p>This method is not recommend to use. In Python &gt;= 3.5, it’s recommend to <code>subprocess</code>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> os</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>os.system(<span class="string">"ls"</span>)</div></pre></td></tr></table></figure>
<p>The downside of this method is that you must handle security stuffs yourself, like shell character escaping, etc. On top of that, this method cannot run the external programs.</p>
</div></article></div></main><footer><div class="paginator"><a href="/2018/03/19/basic-arithmetical-operations-on-the-digital-image/" class="prev">PREV</a><a href="/2018/02/28/python-lib-fire/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2018 <a href="https://free-free.github.io">infinite.ft</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>